window.Whammy=function(){function m(a,b){for(var c=u(a),c=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:v(c.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},
{data:1,id:131},{id:224,data:[{data:c.width,id:176},{data:c.height,id:186}]}]}]},{id:475249515,data:[]}]}],e=c[1],d=e.data[2],f=0,g=0;f<a.length;){d.data.push({id:187,data:[{data:Math.round(g),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]});var h=[],k=0;do h.push(a[f]),k+=a[f].duration,f++;while(f<a.length&&3E4>k);var l=0,h={id:524531317,data:[{data:Math.round(g),id:231}].concat(h.map(function(a){var b=w({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,
timecode:Math.round(l)});l+=a.duration;return{data:b,id:163}}))};e.data.push(h);g+=k}for(g=f=0;g<e.data.length;g++)3<=g&&(d.data[g-3].data[1].data[1].data=f),k=n([e.data[g]],b),f+=k.size||k.byteLength||k.length,2!=g&&(e.data[g]=k);return n(c,b)}function u(a){for(var b=a[0].width,c=a[0].height,e=a[0].duration,d=1;d<a.length;d++){if(a[d].width!=b)throw"Frame "+(d+1)+" has a different width";if(a[d].height!=c)throw"Frame "+(d+1)+" has a different height";if(0>a[d].duration||32767<a[d].duration)throw"Frame "+
(d+1)+" has a weird duration (must be between 0 and 32767)";e+=a[d].duration}return{duration:e,width:b,height:c}}function x(a){for(var b=[];0<a;)b.push(a&255),a>>=8;return new Uint8Array(b.reverse())}function q(a){var b=[];a=(a.length%8?Array(9-a.length%8).join("0"):"")+a;for(var c=0;c<a.length;c+=8)b.push(parseInt(a.substr(c,8),2));return new Uint8Array(b)}function n(a,b){for(var c=[],e=0;e<a.length;e++)if("id"in a[e]){var d=a[e].data;"object"==typeof d&&(d=n(d,b));if("number"==typeof d)if("size"in
a[e]){for(var f=a[e].size,g=new Uint8Array(f),f=f-1;0<=f;f--)g[f]=d&255,d>>=8;d=g}else d=q(d.toString(2));if("string"==typeof d){g=new Uint8Array(d.length);for(f=0;f<d.length;f++)g[f]=d.charCodeAt(f);d=g}for(var f=d.size||d.byteLength||d.length,g=0,h=56;0<h;h-=7)if(f>Math.pow(2,h)-2){g=h/7;break}f=f.toString(2);h=Array(8*(g+1)+1).join("0");g=Array(g+1).join("0")+1;f=h.substr(0,h.length-f.length-g.length)+f;g+=f;c.push(x(a[e].id));c.push(q(g));c.push(d)}else c.push(a[e]);return b?(c=r(c),new Uint8Array(c)):
new Blob(c,{type:"video/webm"})}function r(a,b){null==b&&(b=[]);for(var c=0;c<a.length;c++)"object"==typeof a[c]?r(a[c],b):b.push(a[c]);return b}function w(a){var b=0;a.keyframe&&(b|=128);a.invisible&&(b|=8);a.lacing&&(b|=a.lacing<<1);a.discardable&&(b|=1);if(127<a.trackNum)throw"TrackNumber > 127 not supported";return[a.trackNum|128,a.timecode>>8,a.timecode&255,b].map(function(a){return String.fromCharCode(a)}).join("")+a.frame}function t(a){for(var b=a.RIFF[0].WEBP[0],c=b.indexOf("\u009d\u0001*"),
e=0,d=[];4>e;e++)d[e]=b.charCodeAt(c+3+e);e=d[1]<<8|d[0];c=e&16383;e=d[3]<<8|d[2];return{width:c,height:e&16383,data:b,riff:a}}function p(a){for(var b=0,c={};b<a.length;){var e=a.substr(b,4);c[e]=c[e]||[];if("RIFF"==e||"LIST"==e){var d=parseInt(a.substr(b+4,4).split("").map(function(a){a=a.charCodeAt(0).toString(2);return Array(8-a.length+1).join("0")+a}).join(""),2),f=a.substr(b+4+4,d),b=b+(8+d);c[e].push(p(f))}else"WEBP"==e?c[e].push(a.substr(b+8)):c[e].push(a.substr(b+4)),b=a.length}return c}function v(a){return[].slice.call(new Uint8Array((new Float64Array([a])).buffer),
0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}function l(a,b){this.frames=[];this.duration=1E3/a;this.quality=b||.8}l.prototype.add=function(a,b){if("undefined"!=typeof b&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof b&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";a.canvas&&(a=a.canvas);if(a.toDataURL)a=a.getContext("2d").getImageData(0,0,a.width,a.height);else if("string"!=typeof a)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";
if("string"===typeof a&&!/^data:image\/webp;base64,/ig.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,duration:b||this.duration})};l.prototype.encodeFrames=function(a){if(this.frames[0].image instanceof ImageData){var b=this.frames,c=document.createElement("canvas"),e=c.getContext("2d");c.width=this.frames[0].image.width;c.height=this.frames[0].image.height;var d=function(f){var g=b[f];e.putImageData(g.image,0,0);g.image=c.toDataURL("image/webp",
this.quality);f<b.length-1?setTimeout(function(){d(f+1)},1):a()}.bind(this);d(0)}else a()};l.prototype.compile=function(a,b){this.encodeFrames(function(){var c=new m(this.frames.map(function(a){var b=t(p(atob(a.image.slice(23))));b.duration=a.duration;return b}),a);b(c)}.bind(this))};return{Video:l,fromImageArray:function(a,b,c){return m(a.map(function(a){a=t(p(atob(a.slice(23))));a.duration=1E3/b;return a}),c)},toWebM:m}}();
